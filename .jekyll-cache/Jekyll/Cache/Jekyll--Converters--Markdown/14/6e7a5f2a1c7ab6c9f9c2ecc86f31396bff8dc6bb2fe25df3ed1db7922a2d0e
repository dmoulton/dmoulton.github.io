I"â
<p>Over the past few weeks its become more and more apparent to me that I would need to be able to authenticate some of our internal rails sites to the Active Directory. There are a number of plugins and gems to get the job done, although almost all of them are geared towards vanilla ldap. Of course, Active Directory isnâ€™t <strong>quite</strong> the same as ldap. That shouldnâ€™t come as any surprise.</p>

<p>So, I ended up rolling my own. Not sure who else it will be useful to, but who knows?</p>

<h2 id="usage">Usage</h2>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">gem <span class="nb">install </span>adconnect</code></pre></figure>

<p>This will also install net-ldap.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'adconnect'</span>

<span class="no">Adconnect</span><span class="o">::</span><span class="no">ActiveDirectoryUser</span><span class="p">.</span><span class="nf">server</span> <span class="o">=</span> <span class="s2">"localhost"</span>
<span class="no">Adconnect</span><span class="o">::</span><span class="no">ActiveDirectoryUser</span><span class="p">.</span><span class="nf">port</span> <span class="o">=</span> <span class="s2">"389"</span>
<span class="no">Adconnect</span><span class="o">::</span><span class="no">ActiveDirectoryUser</span><span class="p">.</span><span class="nf">base</span> <span class="o">=</span> <span class="s2">"DC=example,DC=com"</span>
<span class="no">Adconnect</span><span class="o">::</span><span class="no">ActiveDirectoryUser</span><span class="p">.</span><span class="nf">domain</span> <span class="o">=</span> <span class="s2">"example.com"</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">Adconnect</span><span class="o">::</span><span class="no">ActiveDirectoryUser</span><span class="p">.</span><span class="nf">authenticate</span><span class="p">(</span><span class="s1">'myusername'</span><span class="p">,</span><span class="s1">'mypassword'</span><span class="p">)</span>

<span class="n">user</span><span class="p">.</span><span class="nf">cn</span> <span class="c1">#=&gt; ["firstname lastname"]</span></code></pre></figure>

<p>An inspection of the user object will reveal the other fields that you can extract.</p>

<p>The defaults for setup are:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">server: localhost
port: 389
base: 'DC=example,DC=com'
domain: example.com</code></pre></figure>

<p>You should rarely have to override the port setting, so youâ€™ll be able to leave that out during setup.</p>

<p>This is an initial release, and doesnâ€™t have much in the way of error handling or tests. That will come down the road.</p>
:ET