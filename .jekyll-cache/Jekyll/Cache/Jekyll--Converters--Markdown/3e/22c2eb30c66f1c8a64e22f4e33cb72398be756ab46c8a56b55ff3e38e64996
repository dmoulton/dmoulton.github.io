I"ü'<p>For a number of years I have wanted to switch to using all free software involved in my astrophotography. The intent of this post is to outline what I am now using and how it is working out for me.</p>

<p>Let me start with what might be the elephant in the room. Why, when I have likely spent a few or several thousand dollars on imaging hardware for astrophotography, would I decide to make due with free software for capture and processing? The answer is, well, because I want to. I would also say that the free software I am using isn‚Äôt a step down from what I have paid for in the past. It‚Äôs different, and I may have left a few small features behind, but all the major needs are met. I have been a Linux user for many years, since 1996 or so. I believe in its mission and the mission of open source software. I don‚Äôt use it because it‚Äôs cheap, I use it because I think it‚Äôs a good idea.</p>

<p>I‚Äôm going to explain using Linux, but all of this software is available on Macintosh or Windows.</p>

<h2 id="indilib">Indilib</h2>

<p>If you are currently using windows to control your telescope and capture data, you are almost certainly using ASCOM to control your hardware. Ascom is only available on windows. If you aren‚Äôt a windows user, you need to use Indi instead to control your hardware. I won‚Äôt explain how to get set up with Indi. You can find how to do this by going to <a href="http://indilib.org">indilib.org</a>.</p>

<h2 id="data-capture">Data Capture</h2>

<p>There are a few ways to perform capture data using Indi. I have chosen to use KStars. It is probably the widest used of all the possibilities.</p>

<p><img src="/assets/kstars.png" alt="KStars Window" /></p>

<p>You will capture your data using a module within KStars called Ekos. It acts as both the Indi server and a client. You can set up your devices and start working with them to capture. You can use it to capture lights, darks, flats, and biases. I like to change my working directory in Ekos for each target, creating a new directory each time. If I am intending to shoot M11, I create an M11 directory. I choose to also make these target directories a child of a directory for the date. You may have a different method.</p>

<p>In your working directory, Ekos will create directories called Light, Dark, Flat, and Bias. This is assuming you shoot all of those for each target, which you probably won‚Äôt. If you shoot more than one target in a session, you will probably shoot darks, flats, and biases at the start or the end of the session. You might consider putting those in a ‚Äúsupport-files‚Äù directory for the date. Your choice.</p>

<p><img src="/assets/ekos-camera.png" alt="Ekos Window" /></p>

<p>There are good tutorials and blog posts on capturing data with KStars/Ekos. If you have specific questions, ask them in the comments.</p>

<h2 id="processing-your-data-in-siril">Processing Your Data in Siril</h2>

<p>One of the reasons I took awhile to decide to switch to Linux for image processing was that I was using Deep Sky Stacker for stacking my images. I had looked at stackers for other operating systems, but it appeared that DSS was the only simple way to do it. I was very wrong. I finally gave Siril a try. I‚Äôve found it to be nearly as simple as DSS, and as a bonus I can script it so that the stacking happens semi-automatically.</p>

<p><a href="http://siril.org">Siril.org</a></p>

<p>You don‚Äôt have to use scripts in Siril, but I have found that it is easiest for me to use them. Siril has several pre-built scripts to stack your images. I used those for awhile and then wrote my own modifications to them.</p>

<p>If you decide to use the built in scripts, you need to organize your data into specific directories. You need a working directory that consists of these directories</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">lights
darks
flats
biases</code></pre></figure>

<p>They need to be these exact names, including case. No capital letters. You can later choose to modify the scripts and you can rename the directories to match what Ekos produces. I have not found a way to modify Ekos to change those directory names. Your images can be in fits format, or in your camera‚Äôs raw format. I use a Canon DSLR, so I use cr2 format.</p>

<p>You should skip the rest of this section if you are new to siril, or if you are satisfied with how the scripts work.</p>

<p>I had an issue that wasn‚Äôt straight-forward to fix. As I said above, I didn‚Äôt want to have to have copies of the support files, ie darks, flats, biases in each directory that had lights. So, I thought, Linux symbolic links would come to the rescue. Unfortunately, the scripts in siril don‚Äôt work with symbolic links. They move in a relative way, so if I make a symbolic link to the biases directory in my lights directory, when the biases are done being processed the script does a ‚Äúcd ..‚Äù which makes the current working directory whereever the parent of the real biases directory is, because it doesn‚Äôt follow the symbolic link back out. Then when the script tries to cd to the flats directory it doesn‚Äôt exist, because we are in the wrong directory at that point.</p>

<p>So, what to do. I ended up creating small siril scripts that only do one specific portion of stacking. One for biases, another for flats, then darks, and finally lights. I then wrote a small shell script that uses absolute directories instead of relative. Here is that script:</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>
<span class="nv">WORKING_DIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>

siril <span class="nt">-s</span> <span class="nv">$WORKING_DIR</span>/process_biases.ssf <span class="nt">-d</span> <span class="nv">$1</span> <span class="o">&amp;&amp;</span> 
siril <span class="nt">-s</span> <span class="nv">$WORKING_DIR</span>/process_flats.ssf <span class="nt">-d</span> <span class="nv">$1</span> <span class="o">&amp;&amp;</span>
siril <span class="nt">-s</span> <span class="nv">$WORKING_DIR</span>/process_darks.ssf <span class="nt">-d</span> <span class="nv">$1</span> <span class="o">&amp;&amp;</span>
siril <span class="nt">-s</span> <span class="nv">$WORKING_DIR</span>/process_lights.ssf <span class="nt">-d</span> <span class="nv">$1</span>%  </code></pre></figure>

<p>And here are the smaller siril scripts:</p>

<p>process_biases.ssf</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#build master-bias</span>
<span class="nb">cd </span>biases
convertraw bias_
stack bias_ rej 3 3 <span class="nt">-nonorm</span>

close</code></pre></figure>

<p>process_flats.ssf</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#preprocess flats</span>
<span class="nb">cd </span>flats
convertraw flat_
preprocess flat_ <span class="nt">-bias</span><span class="o">=</span>../biases/bias_stacked

<span class="c">#build master-flat</span>
stack pp_flat_ rej 3 3 <span class="nt">-norm</span><span class="o">=</span>mul

close</code></pre></figure>

<p>process_darks.ssf</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#build master-dark</span>
<span class="nb">cd </span>darks
convertraw dark_
stack dark_ rej 3 3 <span class="nt">-nonorm</span>

close</code></pre></figure>

<p>process_lights.ssf</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#preprocess lights</span>
<span class="nb">cd </span>lights
convertraw light_
preprocess light_ <span class="nt">-dark</span><span class="o">=</span>../darks/dark_stacked <span class="nt">-flat</span><span class="o">=</span>../flats/pp_flat_stacked <span class="nt">-cfa</span> <span class="nt">-equalize_cfa</span> <span class="nt">-debayer</span> <span class="nt">-stretch</span>

<span class="c">#align lights</span>
register pp_light_

<span class="c">#stack calibrated lights</span>
stack r_pp_light_ rej 3 3 <span class="nt">-norm</span><span class="o">=</span>addscale <span class="nt">-out</span><span class="o">=</span>../result

close</code></pre></figure>

<p>You can then do</p>

<figure class="highlight"><pre><code class="language-sh" data-lang="sh">stack.sh m11</code></pre></figure>

<p>You will end up with a file called ‚Äúresult.fits‚Äù in the working directory.</p>

<h2 id="post-processing-your-image">Post processing your image</h2>

<p>Once you have the result fits file, open it in siril. You will have something like this:</p>

<p><img src="/assets/siril.png" alt="siril main window" /></p>

<p>I HIGHLY recommend this video for processing in siril. It was a revalation to me.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/U5VndjG819s" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<p>I currently use several of the tools in siril for processing, in this order.</p>

<ol>
  <li>
    <p>Photometric Color Calibration</p>
  </li>
  <li>
    <p>Remove Green Noise‚Ä¶</p>
  </li>
  <li>
    <p>Histogram Transformation‚Ä¶</p>
  </li>
  <li>
    <p>Asinh Transformation‚Ä¶</p>
  </li>
  <li>
    <p>Background Exraction‚Ä¶</p>
  </li>
  <li>
    <p>Deconvolution</p>
  </li>
</ol>

<p>I might do some Color Saturation, but I usually do that in Gimp. I haven‚Äôt learned the other processing tools, but I expect I will learn them in time and put them to use.</p>

<p>At this point I save the file in tif format to move on to Gimp. I am also using <a href="https://glimpse-editor.github.io/">Glimpse</a>, which is a Gimp fork.</p>

<h2 id="gimp">Gimp</h2>

<p>Open the tif file in Gimp and follow the youtube video above. I especially like his method for using a mask to help remove noise in the background black. I‚Äôve gotten better at using layers as well.</p>

<p>I may hash out more specifics on the parts of this workflow, but for now this is how I am doing it at a high level.</p>
:ET